(function(){var a="sproutcore/standard_theme";if(!SC.BUNDLE_INFO){throw"SC.BUNDLE_INFO is not defined!"
}if(SC.BUNDLE_INFO[a]){return}SC.BUNDLE_INFO[a]={requires:["sproutcore/empty_theme"],styles:["/static/sproutcore/standard_theme/en/ae78e682efa8d92ab1f23de86e1e7855014416c6/stylesheet-packed.css","/static/sproutcore/standard_theme/en/ae78e682efa8d92ab1f23de86e1e7855014416c6/stylesheet.css"],scripts:["/static/sproutcore/standard_theme/en/ae78e682efa8d92ab1f23de86e1e7855014416c6/javascript-packed.js"]}
})();ModelEditor=SC.Application.create({NAMESPACE:"ModelEditor",VERSION:"0.1.0",store:SC.Store.create({commitRecordsAutomatically:NO}).from("ModelEditor.ModelDataSource"),bufferedStore:function(){return this.store.chain()
}.property("store").cacheable(),yogoConfig:SC.Object.create({baseURL:null,projectId:null,modelsURL:function(){if(!this.get("baseURL")||!this.get("projectId")){throw"A projectId has not been set!"
}return this.get("baseURL")+"/"+this.get("projectId")+"/yogo_models"}.property("baseURL","projectId").cacheable(),})});
ModelEditor.modelDefinitionController=SC.ObjectController.create({contentBinding:"ModelEditor.modelDefinitionsController.selection",contentBindingDefault:SC.Binding.single(),editModelName:function(b){var a=this.get("content");
var f=ModelEditor.modelDefinitionsController.indexOf(a);var c=ModelEditor.mainPage.getPath("mainPane.sideView.modelListView.contentView");
var d=c.itemViewForContentIndex(f);var e=ModelEditor.ModelNameEdit.extend({});SC.PickerPane.create({layout:{width:150,height:40},contentView:e}).popup(d,SC.PICKER_POINTER,[3,0,1,2,3])
},deleteModel:function(){SC.Logger.debug("Deleting model");var a=this.get("content");
SC.Logger.debug(a);SC.Logger.debug("showing alert pane");SC.AlertPane.warn("Delete: "+a.get("name")+"?","This operation cannot be un-done!",null,"Delete Model","Don't Delete",null,this)
},alertPaneDidDismiss:function(c,a){if(a===SC.BUTTON1_STATUS){var b=this.get("content");
SC.Logger.debug("Destroying model: "+b.get("name"));this.set("content",null);b.destroy()
}},debugModelDefinition:function(){var a=this.get("content");if(a){SC.AlertPane.info(a.get("name"),"Raw Model Definition",JSON.stringify(a.get("readOnlyAttributes")),"OK")
}}});ModelEditor.modelDefinitionsController=SC.ArrayController.create({allowsMultipleSelection:NO,orderBy:"name",newModelCount:1,newModelName:"",showCreateModelView:function(b){var a=ModelEditor.CreateModelPane.create({layout:{width:400,height:75,centerX:0,centerY:0},});
a.append()},createModel:function(c){var b=this.get("newModelName");this.set("newModelName","");
if(b.length===0){return}try{var f=ModelEditor.store.createRecord(ModelEditor.ModelDefinition,{guid:b.classify(),properties:[]});
var a=c.get("pane");a&&a.remove()}catch(d){alert("Duplication model name: "+b)}},cancelCreateModel:function(b){var a=b.get("pane");
a&&a.remove();this.set("newModelName","")},saveModels:function(a){console.debug("Saving to server...");
ModelEditor.store.commitRecords()}});ModelEditor.modelPropertiesController=SC.ArrayController.create(SC.CollectionViewDelegate,{modelDefinitionBinding:"ModelEditor.modelDefinitionController.content",contentBinding:"*modelDefinition.properties",rawProperties:"*content.editableChildren",replace:function(c,b,a){rawObjects=a.map(function(d){if(d.get&&d.get("isChildRecord")){d=d.get("attributes")
}return d});arguments.callee.base.apply(this,[c,b,rawObjects]);return this},addProperty:function(a){SC.Logger.debug("adding Property!");
this.addObject({type:"Text",name:"New Property"})},deleteProperty:function(a){var b=this.get("selection");
if(b){b.forEach(function(c){this.removeObject(c)},this)}},editProperty:function(b){var g=this.get("selection").firstObject();
SC.Logger.debug("Editing property");SC.Logger.debug(g);var f=this.indexOf(g);SC.Logger.debug(f);
var a=ModelEditor.mainPage.getPath("mainPane.centerView.propertyListView.contentView");
SC.Logger.debug(a);var c=a.itemViewForContentIndex(f);SC.Logger.debug(c.get("layer"));
var e=ModelEditor.PropertyEditView.extend({});var d=SC.PickerPane.create({layout:{width:200,height:100},contentView:e});
d.popup(c,SC.PICKER_POINTER,[3,0,1,2,3])},collectionViewComputeDragOperations:function(a,b,d){SC.Logger.debug("Property List is computing drag op.");
if(b.hasDataType(ModelEditor.PropertyType)){var c=b.get("source");SC.Logger.debug("Properties List decided this is a DRAG_COPY.");
return SC.DRAG_COPY}return SC.DRAG_MOVE},collectionViewPerformDragOperation:function(h,c,d,j,i){var b=c.dataForType(ModelEditor.PropertyType),g=h.get("content"),e=h.get("length"),a=c.get("source"),f=SC.DRAG_NONE;
SC.Logger.debug("Property List is recieving a drop!");SC.Logger.debug(b);SC.Logger.debug(a.get("dragContent"));
if(!b){return f}if(i&SC.DROP_AFTER){j++}g.replace(j,0,b);h.select(SC.IndexSet.create(j,1));
h.becomeFirstResponder();return f}});ModelEditor.projectPathController=SC.ObjectController.create({});
ModelEditor.propertyController=SC.ObjectController.create({contentBinding:"ModelEditor.modelPropertiesController.selection",contentBindingDefault:SC.Binding.single(),editProperty:function(a){var b=ModelEditor.PropertyEditView.extend({});
SC.PickerPane.create({layout:{width:350,height:200},contentView:ModelEditor.PropertyEditView.extend({}),}).popup(a,SC.PICKER_POINTER,[3,0,1,2,3])
},});ModelEditor.propertyPaletteController=SC.ArrayController.create(SC.CollectionViewDelegate,{contentBinding:SC.Binding.transform(function(a){return a.toArray()
}).from("ModelEditor.BasicPropertyConfig.propertySet"),isEditable:NO,allowsMultipleSelection:NO,orderBy:"type",collectionViewDragDataTypes:function(a){SC.Logger.debug("PropertyPalette is returning it's drag data types.");
return[ModelEditor.PropertyType]},collectionViewDragDataForType:function(a,e,b){SC.Logger.debug("PropertyPalette is returning data for a datatype.");
SC.Logger.debug(e);var c=null;var d=null;if(b===ModelEditor.PropertyType){SC.Logger.debug("We are returning data for a PropertyType");
d=a.get("selection");c=[];if(d){d.forEach(function(f){c.push({type:f.type,name:"New Property",options:f.options})
},this)}}SC.Logger.debug("PropertyPalette is returning: ");SC.Logger.debug(c);return c
}});ModelEditor.ModelDefinition=SC.Record.extend({properties:SC.Record.toMany("ModelEditor.ModelProperty",{nested:YES}),name:function(){var a=this.get("id");
return a.humanize().titleize()}.property("id").cacheable(),icon:"sc-icon-folder-16",propertyCount:function(){return this.getPath("properties.length")
}.property("properties").cacheable()});sc_require("models/model_definition");ModelEditor.MODELS_QUERY=SC.Query.local(ModelEditor.ModelDefinition,{orderBy:"name"});
ModelEditor.ModelDataSource=SC.DataSource.extend({fetch:function(a,c){var d=ModelEditor.getPath("yogoConfig.modelsURL");
if(c===ModelEditor.MODELS_QUERY){var b=SC.Request.getUrl(d).notify(this,"didFetchModels",a,c);
b.header("Accept","application/json");b.json();b.send();return YES}return NO},didFetchModels:function(b,a,c){if(SC.ok(b)){a.loadRecords(ModelEditor.ModelDefinition,b.get("body").models);
a.dataSourceDidFetchQuery(c)}else{a.dataSourceDidErrorQuery(c,b)}},retrieveRecord:function(a,d){if(SC.kindOf(a.recordTypeFor(d),ModelEditor.ModelDefinition)){var e=a.idFor(d);
var b=ModelEditor.getPath("yogoConfig.modelsURL")+"/"+e;var c=SC.Request.getUrl(url);
c.header("Accept","application/json");c.json();c.notify(this,"didRetrieveModel",a,d);
c.send();return YES}return NO},didRetrieveModel:function(b,a,d){if(SC.ok(b)){var c=b.get("body").Model;
a.dataSourceDidComplete(d,c)}else{a.dataSourceDidError(d,b)}},createRecord:function(a,c){if(SC.kindOf(a.recordTypeFor(c),ModelEditor.ModelDefinition)){var d=ModelEditor.getPath("yogoConfig.modelsURL");
var b=SC.Request.postUrl(d);b.header("Content-Type","application/json");b.header("Accept","application/json");
b.json();b.notify(this,"didCreateModel",a,c);console.debug("createRecord: sending");
b.send({Model:a.readDataHash(c)});return YES}return NO},didCreateModel:function(b,a,d){console.debug("didCreateModel");
if(SC.ok(b)){var c=b.get("body").Model;a.dataSourceDidComplete(d,c)}else{a.dataSourceDidError(d,b)
}},updateRecord:function(a,d){if(SC.kindOf(a.recordTypeFor(d),ModelEditor.ModelDefinition)){var e=a.idFor(d);
var b=ModelEditor.getPath("yogoConfig.modelsURL")+"/"+e;var c=SC.Request.putUrl(b);
c.json();c.header("Content-Type","application/json");c.header("Accept","application/json");
c.notify(this,"didUpdateModel",a,d);c.send({Model:a.readDataHash(d)});return YES}return NO
},didUpdateModel:function(b,a,c){if(SC.ok(b)){var d=b.get("body");d=d&&d.Model;a.dataSourceDidComplete(c,d)
}else{a.dataSourceDidError(c)}},destroyRecord:function(a,d){if(SC.kindOf(a.recordTypeFor(d),ModelEditor.ModelDefinition)){var e=a.idFor(d);
var b=ModelEditor.getPath("yogoConfig.modelsURL")+"/"+e;var c=SC.Request.deleteUrl(b);
c.json();c.header("Content-Type","application/json");c.header("Accept","application/json");
c.notify(this,"didDestroyModel",a,d);c.send();return YES}return NO},didDestroyModel:function(b,a,c){if(SC.ok(b)){a.dataSourceDidDestroy(c)
}else{a.dataSourceDidError(b)}}});sc_require("models/model_definition");ModelEditor.ModelDefinition.FIXTURES=[{guid:"CercalCell",properties:[{type:"Text",name:"Cell Name"},{type:"Text",name:"Hair Length"}]}];
ModelEditor.BasicPropertyConfig=SC.Object.create({Text:SC.Object.create({type:"Text",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-text-16.png",options:{}}),Decimal:SC.Object.create({type:"Decimal",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-number-16.png",options:{}}),Integer:SC.Object.create({type:"Integer",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-number-16.png",options:{}}),TrueFalse:SC.Object.create({type:"TrueFalse",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-true_false-16.png",options:{}}),Date:SC.Object.create({type:"Date",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-date-16.png",options:{}}),Time:SC.Object.create({type:"Time",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-time-16.png",options:{}}),DateTime:SC.Object.create({type:"DateTime",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-date_time-16.png",options:{}}),File:SC.Object.create({type:"File",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-file-16.png",options:{}}),Image:SC.Object.create({type:"Image",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-image-16.png",options:{}}),RecordLink:SC.Object.create({type:"RecordLink",icon:"/static/model_editor/en/b1dacd73029aa37d131637ac272113ae33b39455/resources/icons/icon-record_link-16.png",options:{targetRecord:"",multiple:false}}),propertyList:function(){return[this.Text,this.Integer,this.Decimal,this.TrueFalse,this.Date,this.Time,this.DateTime,this.Image,this.File,this.RecordLink]
}.property("Text","Integer","Decimal","TrueFalse","Date","Time","DateTime","Image","File","RecordLink").cacheable(),propertySet:function(){return SC.Set.create(this.get("propertyList"))
}.property("propertyList").cacheable(),propertyNameList:function(){return this.get("propertyList").getEach("type")
}.property("propertyList").cacheable()});ModelEditor.ModelPropertyOptions=SC.ChildRecord.extend({targetRecord:SC.Record.attr(String),multipleRecords:SC.Record.attr(Boolean)});
ModelEditor.ModelProperty=SC.ChildRecord.extend({childRecordNamespace:ModelEditor,name:SC.Record.attr(String,{isRequired:YES}),options:SC.ChildRecord.toOne("ModelEditor.ModelPropertyOptions",{nested:true}),propType:function(b,c){if(c!==undefined){this.beginEditing();
var a=this.get("attributes");a.type=c;this.endEditing();return this}else{var a=this.get("readOnlyAttributes");
return a.type}}.property(),displayName:function(){return this.get("name")+" ("+this.get("propType")+")"
}.property("name","propType").cacheable(),displayIcon:function(){var a=this.get("propType");
return ModelEditor.BasicPropertyConfig.getPath(a+".icon")||"sc-icon-bookmark-16"}.property("propType").cacheable()});
sc_require("models/model_property");ModelEditor.ModelProperty.FIXTURES=[];ModelEditor.CreateModelPane=SC.PanelPane.extend({contentView:SC.View.extend({childViews:"modelNameLabel modelNameField cancelButton createButton".w(),modelNameLabel:SC.LabelView.extend({layout:{left:10,top:10,width:90,height:20},value:"Model Name"}),modelNameField:SC.TextFieldView.extend({layout:{left:105,top:10,right:10,height:20},valueBinding:"ModelEditor.modelDefinitionsController.newModelName"}),createButton:SC.ButtonView.extend({layout:{right:10,top:40,width:100},title:"Create Model",isEnabledBinding:SC.Binding.from("ModelEditor.modelDefinitionsController.newModelName").bool(),target:"ModelEditor.modelDefinitionsController",action:"createModel"}),cancelButton:SC.ButtonView.extend({layout:{right:120,top:40,width:75},title:"Cancel",target:"ModelEditor.modelDefinitionsController",action:"cancelCreateModel"})})});
ModelEditor.ModelNameEdit=SC.View.extend({childViews:"modelNameField".w(),modelNameField:SC.TextFieldView.extend({layout:{top:10,left:10,right:10,bottom:10},valueBinding:"ModelEditor.modelDefinitionController.name"})});
ModelEditor.PatchedLabelView=SC.LabelView.extend({inlineEditorShouldBeginEditing:function(){return YES
}});ModelEditor.PatchedListItemView=SC.ListItemView.extend({inlineEditorShouldBeginEditing:function(){return YES
}});ModelEditor.PropertyEditView=SC.View.extend({childViews:"propertyNameField propertyTypeField".w(),propertyNameField:SC.TextFieldView.extend({layout:{top:10,left:10,right:10,height:30},valueBinding:"ModelEditor.propertyController.name",nextKeyView:function(){return this.getPath("parentView.propertyTypeField")
}.property(),previousKeyView:function(){return this.getPath("parentView.propertyTypeField")
}.property(),}),propertyTypeField:SC.SelectFieldView.extend({layout:{top:50,left:10,right:10,height:30},valueBinding:"ModelEditor.propertyController.propType",objectsBinding:"ModelEditor.BasicPropertyConfig*propertyList",nameKey:"type",valueKey:"type",nextKeyView:function(){return this.getPath("parentView.propertyNameField")
}.property(),previousKeyView:function(){return this.getPath("parentView.propertyNameField")
}.property(),})});ModelEditor.mainPage=SC.Page.design({mainPane:SC.MainPane.design({childViews:"sideView centerView sidePaletteView".w(),sideView:SC.View.design({childViews:"modelListView toolbarView".w(),layout:{left:0,top:0,bottom:0,width:150},modelListView:SC.ScrollView.design({layout:{left:0,top:0,right:0,bottom:20},contentView:SC.SourceListView.design({exampleView:ModelEditor.PatchedListItemView,contentBinding:"ModelEditor.modelDefinitionsController.arrangedObjects",selectionBinding:"ModelEditor.modelDefinitionsController.selection",contentValueKey:"name",canEditContent:NO,hasContentIcon:YES,contentIconKey:"icon",contentUnreadCountKey:"propertyCount",actOnSelect:NO})}),toolbarView:SC.ToolbarView.design({childViews:"modelAddButton modelDeleteButton saveButton".w(),layout:{bottom:0,left:0,right:0,height:20},anchorLocation:SC.ANCHOR_BOTTOM,modelAddButton:SC.ButtonView.design({layout:{left:0,top:0,bottom:0,width:18},title:"+",titleMinWidth:15,controlSize:SC.SMALL_CONTROL_SIZE,target:"ModelEditor.modelDefinitionsController",action:"showCreateModelView",isEnabledBinding:"ModelEditor.modelDefinitionsController.canAddContent"}),modelDeleteButton:SC.ButtonView.design({layout:{left:20,top:0,bottom:0,width:18},title:"-",titleMinWidth:15,controlSize:SC.SMALL_CONTROL_SIZE,target:"ModelEditor.modelDefinitionController",action:"deleteModel",isEnabledBinding:"ModelEditor.modelDefinitionController.hasContent"}),saveButton:SC.ButtonView.design({layout:{top:0,bottom:0,right:10,width:30},title:"Save",titleMinWidth:15,controlSize:SC.SMALL_CONTROL_SIZE,target:"ModelEditor.modelDefinitionsController",action:"saveModels"})})}),centerView:SC.View.design({childViews:"propertyListView toolbarView".w(),layout:{left:150,top:0,bottom:0,right:150},propertyListView:SC.ScrollView.design({layout:{top:0,left:0,right:0,bottom:20},contentView:SC.ListView.design({rowHeight:30,exampleView:ModelEditor.PatchedListItemView,contentBinding:"ModelEditor.modelPropertiesController.arrangedObjects",selectionBinding:"ModelEditor.modelPropertiesController.selection",contentValueKey:"displayName",hasContentIcon:YES,contentIconKey:"displayIcon",canReorderContent:true,canEditContent:NO,isDropTarget:YES,target:"ModelEditor.modelPropertiesController",action:"editProperty"})}),toolbarView:SC.ToolbarView.design({childViews:"propertyAddButton propertyDeleteButton devButton".w(),layout:{bottom:0,left:0,right:0,height:20},anchorLocation:SC.ANCHOR_BOTTOM,propertyAddButton:SC.ButtonView.design({layout:{left:0,top:0,bottom:0,width:18},title:"+",titleMinWidth:15,controlSize:SC.SMALL_CONTROL_SIZE,target:"ModelEditor.modelPropertiesController",action:"addProperty",}),propertyDeleteButton:SC.ButtonView.design({layout:{left:20,top:0,bottom:0,width:18},title:"-",titleMinWidth:15,controlSize:SC.SMALL_CONTROL_SIZE,target:"ModelEditor.modelPropertiesController",action:"deleteProperty",}),devButton:SC.ButtonView.design({layout:{right:0,top:0,bottom:0,width:50},title:"debug prop",titleMinWidth:20,controlSize:SC.SMALL_CONTROL_SIZE,target:"ModelEditor.modelDefinitionController",action:"debugModelDefinition"})})}),sidePaletteView:SC.View.design({childViews:"propertyPaletteView toolbarView".w(),layout:{top:0,right:0,bottom:0,width:150},toolbarView:SC.ToolbarView.design({childViews:"".w(),layout:{bottom:0,left:0,right:0,height:20},anchorLocation:SC.ANCHOR_BOTTOM,}),propertyPaletteView:SC.ScrollView.design({layout:{top:0,left:0,right:0,bottom:20},contentView:SC.SourceListView.design({contentBinding:"ModelEditor.propertyPaletteController.arrangedObjects",contentValueKey:"type",hasContentIcon:YES,contentIconKey:"icon",selectOnMouseDown:YES,isEnabledBinding:SC.Binding.from("ModelEditor.modelDefinitionsController.selection").notEmpty()})})})})});
ModelEditor.main=function main(){ModelEditor.getPath("mainPage.mainPane").append();
if(window.self!==window.top){}else{ModelEditor.mainDataLoad("/projects","1")}};ModelEditor.mainDataLoad=function(b,a){ModelEditor.yogoConfig.set("baseURL",b);
ModelEditor.yogoConfig.set("projectId",a);var c=ModelEditor.store.find(ModelEditor.MODELS_QUERY);
ModelEditor.modelDefinitionsController.set("content",c)};function main(){ModelEditor.main()
};