- content_for(:javascripts) do
  :javascript
    dojo.require("dijit.Dialog");
    dojo.require("dojox.grid.EnhancedGrid");
    dojo.require("dojox.grid.enhanced.plugins.NestedSorting");
    dojo.require("dojox.grid.enhanced.plugins.Filter");
    dojo.require("dijit.layout.TabContainer");
    dojo.require("dojox.grid.enhanced.plugins.IndirectSelection");
    dojo.require ("voeis.Server")
    var projectsDataStore = voeis.Server.DEFAULT.projectsDataStore();
    var projectStore = dojo.store.JsonRest({target: "#{root_url}projects.json?"});
    var Sitestore = voeis.Server.DEFAULT.projectSitesDataStore('#{@project.id}');
    var item = projectStore.get('id=#{@project.id}');
    dojo.addOnLoad(function(){
      dijit.byId('split_map').store.add(item.results[0][0]);
    });

- content_for(:toolbar) do
  #projectButton{:dojoType => "dijit.form.DropDownButton", :iconClass => "project-icon-25"}
    %span 
      = @project.name
    %div{:dojoType => "dijit.Menu"}                    
      -if !current_user.nil? && current_user.projects.include?(@project)
        = link_to("Add Site", new_project_site_path(@project), :dojoType => "yogo.ui.MenuLink")
      - if @sites.count > 0
        = link_to("Add Variable", new_project_variable_path(@project), :dojoType => "yogo.ui.MenuLink")
        = link_to("Add Unit", new_project_unit_path(@project), :dojoType => "yogo.ui.MenuLink")
        = link_to("Add Sample", new_project_sample_path(@project), :dojoType => "yogo.ui.MenuLink")
        -#= link_to("Upload Sample Data", @project.id.to_s+"/data_values/pre_process_sample_file_upload", :dojoType => "yogo.ui.MenuLink")
        = link_to("Add Data Stream", new_project_data_stream_path(@project), :params => {:project_id => @project.id}, :dojoType => "yogo.ui.MenuLink")
        
      - if @project.managed_repository { Voeis::Sample.all.count } > 0
        = link_to("Add Sample Data", pre_process_samples_file_upload_project_data_values_path(@project), :dojoType => "yogo.ui.MenuLink")
        = link_to("Add Field Data", new_field_measurement_project_sensor_values_path(@project), :params => {:project_id => @project.id}, :dojoType => "yogo.ui.MenuLink")
      - if @project.managed_repository { Voeis::DataStream.all.count } > 0
        = link_to("Add Data", add_project_data_streams_path(@project), :params => {:project_id => @project.id}, :dojoType => "yogo.ui.MenuLink")
      = link_to("Settings...", edit_project_path(@project), :dojoType => "yogo.ui.MenuLink")

            
#content-actions
  
#content-title 
  - if @project.is_private == true
    %span.icon.icon-private= @project.name
  - else
    %span.icon= @project.name
  #links

    - if @project.managed_repository { Voeis::DataStream.all.count } > 0
      = link_to("Browse Data Streams", query_project_data_streams_path(@project), :class => 'button-link')
    - if @project.managed_repository { !Voeis::DataValue.first.nil? }
      = link_to("Browse Sample Data", query_project_samples_path(@project), :class => 'button-link')
= clear_break
#overview
  %h4
    %a{:href=>"#"}
      Project Overview
  .overview-item
    #overview-text
      %p
        - if @project.description && @project.description.length > 0
          = @project.description
        - else
          = link_to('[Add Project Description]', edit_project_path(@project))
    = render(:partial => 'overview_map', :locals => { :project => @project,
                                                      :sites => @sites,
                                                      :class_name => 'show-map' } )
    %h3 Sites:
    %table{:dojoType=>"dojox.grid.EnhancedGrid", :plugins=> "{nestedSorting:true, filter:true}",  :store=>"Sitestore", :clientSort=>"true", :style=>"width: 600px; height: 250px;", :rowSelector=>"20px", :jsId=>"SiteDisplayGrid", :id=>"SiteDisplayGrid", :title=>"Sites"}
      %thead
        %tr
          %th{:field=>"name", :width=>"200px", :filterable=>true}
            Name
          %th{:field=>"code", :width=>"150px", :filterable=>true}
            Code
          %th{:field=>"latitude", :width=>"100px", :filterable=>true}
            Lat
          %th{:field=>"longitude", :width=>"100px", :filterable=>true}
            Long
-#.data-browser
-##content-sidebar-left
-#= render_cell(:site_browser, :display, :project => resource)
-#= render(:partial => 'site_streams_picker', :locals => { :project => @project })  
#main-with-sidebar-left
-# #graph-accordion
-# %h3
-# %a{:href=>"#"}
-# Graph
-# .data-graph
-# = render(:partial => 'graph',:locals => {:data => @current_data, :labels => @label_array, :project => @project, :class_name => 'data-graph' })
-# .data-table                                            
-# = render(:partial => 'data_table', :locals => { :data => @current_data, :labels => @label_array,:project => @project, :class_name => 'data-table' })  
  
= clear_break



#hidden-cells-and-partial
  -#=render_cell(:add_site, :display_form, :site => @site, :project => @project)
