%h1 Search Sample Data:
= form_for(:query, @query, :url => { :action => 'search'}, :remote => true) do |f|
  Site: 
  = select_tag("site", @site_options.html_safe)
  = clear_break
  Variable: 
  = select_tag("variable", @variable_opts.html_safe)
  = clear_break
  Dates After: 
  = date_select('range', 'start_date', :start_year => @start_year, :end_year => @end_year, :order => [:month, :day, :year])
  Dates Before: 
  = date_select('range', 'end_date', :start_year => @start_year, :end_year => @end_year, :order => [:month, :day, :year])
  = clear_break

  = f.submit('Search', :onclick => "dijit.byId('loading_dialog').show();")
  = link_to('Cancel', project_path(@project), :class => 'icon icon-cancel') 
= clear_break

%div{:dojoType=>"dijit.Dialog", :disableCloseButton => true, :id=>"loading_dialog", :title=>"Loading..."}
  #search-div-loader
#search_results
  :javascript  
    dojo.require('dijit.Dialog');
    $(function() { 
    $("#site").change(function() { 
    $('#loader').toggle();
    $.get("#{site_sample_variables_project_samples_path}"+".json?site_id=" + $("#site").val(),
    function(data) {
    $('#variable').empty();
    if (data.variables.length == 0){
    $('#variable').append($("<option></option>").attr("value","None").text("None"));
    }
    else{  
    //$('#variable').append($("<option></option>").attr("value","All").text("All"));
    }
    var i = 0;
    for(i=0;data.variables.length; i++)
    {
    $('#variable'). append($("<option></option>").attr("value",data.variables[i].id).text(data.variables[i].name));
    $('#loader').toggle();
    }
    $('#loader').toggle();
    return false;
    }
    );
    return false;
    });
    });